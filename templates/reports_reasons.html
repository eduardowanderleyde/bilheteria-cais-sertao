{% extends "base.html" %}
{% set active = "reports" %}

{% block content %}
<h1 class="text-3xl font-bold mb-6">Relatórios por Motivos</h1>

<!-- Filtros -->
<div class="bg-white rounded-xl p-6 shadow mb-6">
  <h2 class="text-xl font-bold mb-4">Filtros</h2>
  <form method="get" class="grid sm:grid-cols-4 gap-4">
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Data Início</label>
      <input name="start_date" type="date" value="{{ start_date or '' }}" class="w-full h-12 border rounded-lg px-3">
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Data Fim</label>
      <input name="end_date" type="date" value="{{ end_date or '' }}" class="w-full h-12 border rounded-lg px-3">
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">UF</label>
      <select name="state" class="w-full h-12 border rounded-lg px-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white border-slate-300">
        <option value="">Todas as UFs</option>
        <option value="AC">AC - Acre</option>
        <option value="AL">AL - Alagoas</option>
        <option value="AP">AP - Amapá</option>
        <option value="AM">AM - Amazonas</option>
        <option value="BA">BA - Bahia</option>
        <option value="CE">CE - Ceará</option>
        <option value="DF">DF - Distrito Federal</option>
        <option value="ES">ES - Espírito Santo</option>
        <option value="GO">GO - Goiás</option>
        <option value="MA">MA - Maranhão</option>
        <option value="MT">MT - Mato Grosso</option>
        <option value="MS">MS - Mato Grosso do Sul</option>
        <option value="MG">MG - Minas Gerais</option>
        <option value="PA">PA - Pará</option>
        <option value="PB">PB - Paraíba</option>
        <option value="PR">PR - Paraná</option>
        <option value="PE">PE - Pernambuco</option>
        <option value="PI">PI - Piauí</option>
        <option value="RJ">RJ - Rio de Janeiro</option>
        <option value="RN">RN - Rio Grande do Norte</option>
        <option value="RS">RS - Rio Grande do Sul</option>
        <option value="RO">RO - Rondônia</option>
        <option value="RR">RR - Roraima</option>
        <option value="SC">SC - Santa Catarina</option>
        <option value="SP">SP - São Paulo</option>
        <option value="SE">SE - Sergipe</option>
        <option value="TO">TO - Tocantins</option>
      </select>
    </div>
    <div class="flex items-end">
      <button type="submit" class="w-full h-12 bg-indigo-600 text-white rounded-lg">Filtrar</button>
    </div>
  </form>
</div>

<!-- Relatório de Meias -->
<div class="bg-white rounded-xl shadow mb-6">
  <div class="p-6">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-bold">Meias Entradas por Motivo</h2>
      <a href="/api/reports/reasons/export?type=meia&start={{ start_date or '' }}&end={{ end_date or '' }}&state={{ state or '' }}" 
         class="inline-flex items-center h-10 px-4 rounded-lg bg-green-600 text-white text-sm hover:bg-green-700">
        ⬇️ Exportar Excel
      </a>
    </div>
    
    {% if meias_reasons %}
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead>
          <tr class="border-b">
            <th class="text-left py-2">Motivo</th>
            <th class="text-left py-2">Quantidade</th>
            <th class="text-left py-2">Receita</th>
          </tr>
        </thead>
        <tbody>
          {% for motivo in meias_reasons %}
          <tr class="border-b hover:bg-gray-50">
            <td class="py-2">{{ motivo[0] }}</td>
            <td class="py-2">{{ motivo[1] }}</td>
            <td class="py-2">R$ {{ motivo[2] }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="text-center py-8 text-gray-500">
      Nenhuma meia entrada encontrada no período
    </div>
    {% endif %}
  </div>
</div>

<!-- Relatório de Gratuitas -->
<div class="bg-white rounded-xl shadow mb-6">
  <div class="p-6">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-bold">Gratuitas por Motivo</h2>
      <a href="/api/reports/reasons/export?type=gratuita&start={{ start_date or '' }}&end={{ end_date or '' }}&state={{ state or '' }}" 
         class="inline-flex items-center h-10 px-4 rounded-lg bg-purple-600 text-white text-sm hover:bg-purple-700">
        ⬇️ Exportar Excel
      </a>
    </div>
    
    {% if gratuitas_reasons %}
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead>
          <tr class="border-b">
            <th class="text-left py-2">Motivo</th>
            <th class="text-left py-2">Quantidade</th>
            <th class="text-left py-2">Observação</th>
          </tr>
        </thead>
        <tbody>
          {% for motivo in gratuitas_reasons %}
          <tr class="border-b hover:bg-gray-50">
            <td class="py-2">{{ motivo[0] }}</td>
            <td class="py-2">{{ motivo[1] }}</td>
            <td class="py-2">Gratuidade</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="text-center py-8 text-gray-500">
      Nenhuma gratuidade encontrada no período
    </div>
    {% endif %}
  </div>
</div>

<a href="/reports" class="block text-center mt-6 text-slate-600">← Voltar aos Relatórios</a>
{% endblock %}
