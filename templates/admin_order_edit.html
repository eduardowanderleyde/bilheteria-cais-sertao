{% extends "base.html" %}
{% set active = "admin" %}

{% block content %}
<h1 class="text-3xl font-bold mb-6">Editar Pedido #{{ order.id }}</h1>

<div class="bg-white rounded-xl p-6 shadow mb-4">
  <div class="text-sm text-gray-600 mb-4">
    <strong>Criado em:</strong> {{ order.created_at[:16] }} | 
    <strong>Operador:</strong> {{ order.operator_username }}
  </div>
</div>

<form method="post" action="/admin/orders/{{ order.id }}/edit" class="grid lg:grid-cols-3 gap-6">
  <div class="bg-white rounded-xl p-6 shadow lg:col-span-2 space-y-4">
    <!-- Qtd por tipo -->
    <div class="grid sm:grid-cols-3 gap-3">
      <div class="p-4 border rounded-xl">
        <div class="font-semibold mb-1">Inteira (R$10)</div>
        <input type="number" name="qtd_inteira" value="{{ order.qtd_inteira }}" min="0" class="w-full h-12 border rounded px-3" id="qtd_inteira">
      </div>
      <div class="p-4 border rounded-xl">
        <div class="font-semibold mb-1">Meia (R$5)</div>
        <input type="number" name="qtd_meia" value="{{ order.qtd_meia }}" min="0" class="w-full h-12 border rounded px-3 mb-2" id="qtd_meia">
        <select name="reason_meia" class="w-full h-10 border rounded-lg px-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white border-slate-300 text-sm">
          <option value="">Motivo da meia entrada</option>
          <option value="idoso" {% if order.reason_meia == 'idoso' %}selected{% endif %}>Idoso (60+)</option>
          <option value="professor_ins_particular" {% if order.reason_meia == 'professor_ins_particular' %}selected{% endif %}>Professor - Instituição Particular</option>
          <option value="estudante_ins_particular" {% if order.reason_meia == 'estudante_ins_particular' %}selected{% endif %}>Estudante - Instituição Particular</option>
          <option value="pcd_acompanhante" {% if order.reason_meia == 'pcd_acompanhante' %}selected{% endif %}>PCD + Acompanhante</option>
          <option value="doador_sangue" {% if order.reason_meia == 'doador_sangue' %}selected{% endif %}>Doador de Sangue</option>
          <option value="enfermagem" {% if order.reason_meia == 'enfermagem' %}selected{% endif %}>Profissional de Enfermagem</option>
        </select>
      </div>
      <div class="p-4 border rounded-xl">
        <div class="font-semibold mb-1">Gratuita (R$0)</div>
        <input type="number" name="qtd_gratuita" value="{{ order.qtd_gratuita }}" min="0" class="w-full h-12 border rounded px-3 mb-2" id="qtd_gratuita">
        <select name="reason_gratuita" class="w-full h-10 border rounded-lg px-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white border-slate-300 text-sm">
          <option value="">Motivo da gratuidade</option>
          <option value="estudante_rede_publica" {% if order.reason_gratuita == 'estudante_rede_publica' %}selected{% endif %}>Estudante - Rede Pública</option>
          <option value="professor_ins_publica" {% if order.reason_gratuita == 'professor_ins_publica' %}selected{% endif %}>Professor - Instituição Pública</option>
          <option value="guia_turismo" {% if order.reason_gratuita == 'guia_turismo' %}selected{% endif %}>Guia de Turismo</option>
          <option value="crianca_0_5" {% if order.reason_gratuita == 'crianca_0_5' %}selected{% endif %}>Criança 0-5 anos</option>
          <option value="politica_gratuidade" {% if order.reason_gratuita == 'politica_gratuidade' %}selected{% endif %}>Política de Gratuidade</option>
          <option value="funcionario_museu" {% if order.reason_gratuita == 'funcionario_museu' %}selected{% endif %}>Funcionário do Museu</option>
          <option value="policial_bombeiro_militar" {% if order.reason_gratuita == 'policial_bombeiro_militar' %}selected{% endif %}>Policial/Bombeiro Militar</option>
        </select>
      </div>
    </div>

    <!-- Dados opcionais -->
    <div class="grid sm:grid-cols-3 gap-3">
      <div>
        <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Nome</label>
        <input id="name" name="name" placeholder="Nome (opcional)" value="{{ order.name or '' }}" class="w-full h-12 border rounded-lg px-3">
      </div>
      <div>
        <label for="state" class="block text-sm font-medium text-gray-700 mb-1">UF</label>
        <select id="state" name="state" class="w-full h-12 border rounded-lg px-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white border-slate-300">
          <option value="">Selecione</option>
          <option value="AC" {% if order.state == 'AC' %}selected{% endif %}>AC - Acre</option>
          <option value="AL" {% if order.state == 'AL' %}selected{% endif %}>AL - Alagoas</option>
          <option value="AP" {% if order.state == 'AP' %}selected{% endif %}>AP - Amapá</option>
          <option value="AM" {% if order.state == 'AM' %}selected{% endif %}>AM - Amazonas</option>
          <option value="BA" {% if order.state == 'BA' %}selected{% endif %}>BA - Bahia</option>
          <option value="CE" {% if order.state == 'CE' %}selected{% endif %}>CE - Ceará</option>
          <option value="DF" {% if order.state == 'DF' %}selected{% endif %}>DF - Distrito Federal</option>
          <option value="ES" {% if order.state == 'ES' %}selected{% endif %}>ES - Espírito Santo</option>
          <option value="GO" {% if order.state == 'GO' %}selected{% endif %}>GO - Goiás</option>
          <option value="MA" {% if order.state == 'MA' %}selected{% endif %}>MA - Maranhão</option>
          <option value="MT" {% if order.state == 'MT' %}selected{% endif %}>MT - Mato Grosso</option>
          <option value="MS" {% if order.state == 'MS' %}selected{% endif %}>MS - Mato Grosso do Sul</option>
          <option value="MG" {% if order.state == 'MG' %}selected{% endif %}>MG - Minas Gerais</option>
          <option value="PA" {% if order.state == 'PA' %}selected{% endif %}>PA - Pará</option>
          <option value="PB" {% if order.state == 'PB' %}selected{% endif %}>PB - Paraíba</option>
          <option value="PR" {% if order.state == 'PR' %}selected{% endif %}>PR - Paraná</option>
          <option value="PE" {% if order.state == 'PE' %}selected{% endif %}>PE - Pernambuco</option>
          <option value="PI" {% if order.state == 'PI' %}selected{% endif %}>PI - Piauí</option>
          <option value="RJ" {% if order.state == 'RJ' %}selected{% endif %}>RJ - Rio de Janeiro</option>
          <option value="RN" {% if order.state == 'RN' %}selected{% endif %}>RN - Rio Grande do Norte</option>
          <option value="RS" {% if order.state == 'RS' %}selected{% endif %}>RS - Rio Grande do Sul</option>
          <option value="RO" {% if order.state == 'RO' %}selected{% endif %}>RO - Rondônia</option>
          <option value="RR" {% if order.state == 'RR' %}selected{% endif %}>RR - Roraima</option>
          <option value="SC" {% if order.state == 'SC' %}selected{% endif %}>SC - Santa Catarina</option>
          <option value="SP" {% if order.state == 'SP' %}selected{% endif %}>SP - São Paulo</option>
          <option value="SE" {% if order.state == 'SE' %}selected{% endif %}>SE - Sergipe</option>
          <option value="TO" {% if order.state == 'TO' %}selected{% endif %}>TO - Tocantins</option>
        </select>
      </div>
      <div>
        <label for="city" class="block text-sm font-medium text-gray-700 mb-1">Cidade</label>
        <input id="city" name="city" placeholder="Cidade" value="{{ order.city or '' }}" class="w-full h-12 border rounded-lg px-3">
      </div>
    </div>
    <input name="note" placeholder="Observação" value="{{ order.note or '' }}" class="border rounded-lg px-3 h-12 w-full">
  </div>

  <div class="bg-white rounded-xl p-6 shadow">
    <div class="text-slate-500 text-sm">Resumo</div>
    <div class="text-2xl font-bold mt-2" id="previewTotal">Total calculado na confirmação</div>
    <button type="submit" class="w-full h-14 mt-4 rounded-xl bg-blue-700 text-white text-lg">
      Salvar Alterações
    </button>
    <a href="/admin/orders" class="block text-center mt-3 text-slate-600">← Voltar aos Pedidos</a>
  </div>
</form>
{% endblock %}

