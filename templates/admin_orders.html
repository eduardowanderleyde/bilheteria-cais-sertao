{% extends "base.html" %}
{% set active = "admin" %}

{% block content %}
<h1 class="text-3xl font-bold mb-6">Admin - Pedidos</h1>

<!-- Filtros -->
<div class="bg-white rounded-xl p-6 shadow mb-6">
  <h2 class="text-xl font-bold mb-4">Filtros</h2>
  <form method="get" class="grid sm:grid-cols-5 gap-4">
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Data In√≠cio</label>
      <input name="start_date" type="date" value="{{ start_date or '' }}" class="w-full h-12 border rounded-lg px-3">
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Data Fim</label>
      <input name="end_date" type="date" value="{{ end_date or '' }}" class="w-full h-12 border rounded-lg px-3">
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">UF</label>
      <select name="state" class="w-full h-12 border rounded-lg px-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white border-slate-300">
        <option value="">Todas as UFs</option>
        <option value="AC">AC - Acre</option>
        <option value="AL">AL - Alagoas</option>
        <option value="AP">AP - Amap√°</option>
        <option value="AM">AM - Amazonas</option>
        <option value="BA">BA - Bahia</option>
        <option value="CE">CE - Cear√°</option>
        <option value="DF">DF - Distrito Federal</option>
        <option value="ES">ES - Esp√≠rito Santo</option>
        <option value="GO">GO - Goi√°s</option>
        <option value="MA">MA - Maranh√£o</option>
        <option value="MT">MT - Mato Grosso</option>
        <option value="MS">MS - Mato Grosso do Sul</option>
        <option value="MG">MG - Minas Gerais</option>
        <option value="PA">PA - Par√°</option>
        <option value="PB">PB - Para√≠ba</option>
        <option value="PR">PR - Paran√°</option>
        <option value="PE">PE - Pernambuco</option>
        <option value="PI">PI - Piau√≠</option>
        <option value="RJ">RJ - Rio de Janeiro</option>
        <option value="RN">RN - Rio Grande do Norte</option>
        <option value="RS">RS - Rio Grande do Sul</option>
        <option value="RO">RO - Rond√¥nia</option>
        <option value="RR">RR - Roraima</option>
        <option value="SC">SC - Santa Catarina</option>
        <option value="SP">SP - S√£o Paulo</option>
        <option value="SE">SE - Sergipe</option>
        <option value="TO">TO - Tocantins</option>
      </select>
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Buscar</label>
      <input name="q" type="text" placeholder="Nome, cidade, operador..." value="{{ q or '' }}" class="w-full h-12 border rounded-lg px-3">
    </div>
    <div class="flex items-end">
      <button type="submit" class="w-full h-12 bg-indigo-600 text-white rounded-lg">Filtrar</button>
    </div>
  </form>
</div>

<!-- Tabela de Pedidos -->
<div class="bg-white rounded-xl shadow mb-6">
  <div class="p-6">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-bold">Pedidos</h2>
      <div class="text-sm text-gray-600">
        P√°gina {{ page }} de {{ total_pages }}
      </div>
    </div>
    
    {% if orders %}
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead>
          <tr class="border-b">
            <th class="text-left py-2">Data/Hora</th>
            <th class="text-left py-2">Operador</th>
            <th class="text-left py-2">Inteiras</th>
            <th class="text-left py-2">Meias</th>
            <th class="text-left py-2">Gratuitas</th>
            <th class="text-left py-2">Receita</th>
            <th class="text-left py-2">UF/Cidade</th>
            <th class="text-left py-2">A√ß√µes</th>
          </tr>
        </thead>
        <tbody>
          {% for order in orders %}
          <tr class="border-b hover:bg-gray-50">
            <td class="py-2">{{ order[1][:16] }}</td>
            <td class="py-2">{{ order[2] }}</td>
            <td class="py-2">{{ order[6] or 0 }}</td>
            <td class="py-2">{{ order[7] or 0 }}</td>
            <td class="py-2">{{ order[8] or 0 }}</td>
            <td class="py-2">R$ {{ order[9] }}</td>
            <td class="py-2">{{ order[3] or '-' }}{% if order[4] %} / {{ order[4] }}{% endif %}</td>
            <td class="py-2">
              <div class="flex gap-2">
                <a href="/admin/orders/{{ order[0] }}/edit" class="text-blue-600 hover:text-blue-800 text-sm">
                  ‚úèÔ∏è Editar
                </a>
                <button onclick="showDeleteModal({{ order[0] }})" class="text-red-600 hover:text-red-800 text-sm">
                  üóëÔ∏è Excluir
                </button>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    
    <!-- Pagina√ß√£o -->
    {% if total_pages > 1 %}
    <div class="flex justify-center mt-6">
      <div class="flex gap-2">
        {% if has_prev %}
        <a href="?page={{ page - 1 }}{% if start_date %}&start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}{% if state %}&state={{ state }}{% endif %}{% if q %}&q={{ q }}{% endif %}" 
           class="px-3 py-2 border rounded-lg hover:bg-gray-50">‚Üê Anterior</a>
        {% endif %}
        
        <span class="px-3 py-2 border rounded-lg bg-indigo-100">{{ page }}</span>
        
        {% if has_next %}
        <a href="?page={{ page + 1 }}{% if start_date %}&start_date={{ start_date }}{% endif %}{% if end_date %}&end_date={{ end_date }}{% endif %}{% if state %}&state={{ state }}{% endif %}{% if q %}&q={{ q }}{% endif %}" 
           class="px-3 py-2 border rounded-lg hover:bg-gray-50">Pr√≥ximo ‚Üí</a>
        {% endif %}
      </div>
    </div>
    {% endif %}
    
    {% else %}
    <div class="text-center py-8 text-gray-500">
      Nenhum pedido encontrado
    </div>
    {% endif %}
  </div>
</div>

<!-- Modal de Exclus√£o -->
<div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 hidden">
  <div class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white rounded-xl p-6 max-w-md w-full">
      <h3 class="text-lg font-bold mb-4">Confirmar Exclus√£o</h3>
      <p class="text-gray-600 mb-4">Tem certeza que deseja excluir este pedido?</p>
      <form id="deleteForm" method="post">
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-1">Motivo da exclus√£o</label>
          <input name="reason" type="text" placeholder="Motivo (opcional)" class="w-full h-10 border rounded-lg px-3">
        </div>
        <div class="flex gap-3">
          <button type="submit" class="flex-1 h-10 bg-red-600 text-white rounded-lg">Excluir</button>
          <button type="button" onclick="hideDeleteModal()" class="flex-1 h-10 bg-gray-300 text-gray-700 rounded-lg">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
function showDeleteModal(orderId) {
  document.getElementById('deleteForm').action = `/admin/orders/${orderId}/delete`;
  document.getElementById('deleteModal').classList.remove('hidden');
}

function hideDeleteModal() {
  document.getElementById('deleteModal').classList.add('hidden');
}
</script>
{% endblock %}

