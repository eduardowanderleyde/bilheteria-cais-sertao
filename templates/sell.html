{% extends "base.html" %}
{% block title %}Vender Ingressos{% endblock %}

{% block content %}
<h1 class="text-3xl font-bold mb-6">Vender Ingressos</h1>

<form method="post" action="/sell" class="grid lg:grid-cols-3 gap-6">
  <div class="bg-white rounded-xl p-6 shadow lg:col-span-2 space-y-4">

    <!-- Qtd por tipo -->
    <div class="grid sm:grid-cols-3 gap-3">
      <div class="p-4 border rounded-xl">
        <div class="font-semibold mb-1">Inteira (R$10)</div>
        <input type="number" name="qtd_inteira" value="0" min="0" class="w-full h-12 border rounded px-3" id="qtd_inteira">
      </div>
      <div class="p-4 border rounded-xl">
        <div class="font-semibold mb-1">Meia (R$5)</div>
        <input type="number" name="qtd_meia" value="0" min="0" class="w-full h-12 border rounded px-3 mb-2" id="qtd_meia">
        <select name="reason_meia" class="w-full h-10 border rounded-lg px-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white border-slate-300 text-sm">
          <option value="">Motivo da meia entrada</option>
          <option value="idoso">Idoso (60+)</option>
          <option value="professor_ins_particular">Professor - Institui√ß√£o Particular</option>
          <option value="estudante_ins_particular">Estudante - Institui√ß√£o Particular</option>
          <option value="pcd_acompanhante">PCD + Acompanhante</option>
          <option value="doador_sangue">Doador de Sangue</option>
          <option value="enfermagem">Profissional de Enfermagem</option>
        </select>
      </div>
      <div class="p-4 border rounded-xl">
        <div class="font-semibold mb-1">Gratuita (R$0)</div>
        <input type="number" name="qtd_gratuita" value="0" min="0" class="w-full h-12 border rounded px-3 mb-2" id="qtd_gratuita">
        <select name="reason_gratuita" class="w-full h-10 border rounded-lg px-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white border-slate-300 text-sm">
          <option value="">Motivo da gratuidade</option>
          <option value="estudante_rede_publica">Estudante - Rede P√∫blica</option>
          <option value="professor_ins_publica">Professor - Institui√ß√£o P√∫blica</option>
          <option value="guia_turismo">Guia de Turismo</option>
          <option value="crianca_0_5">Crian√ßa 0-5 anos</option>
          <option value="politica_gratuidade">Pol√≠tica de Gratuidade</option>
          <option value="funcionario_museu">Funcion√°rio do Museu</option>
          <option value="policial_bombeiro_militar">Policial/Bombeiro Militar</option>
        </select>
      </div>
    </div>

    <!-- Dados opcionais -->
    <div class="grid sm:grid-cols-3 gap-3">
      <div>
        <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Nome</label>
        <input id="name" name="name" placeholder="Nome (opcional)" class="w-full h-12 border rounded-lg px-3">
      </div>
      <div>
        <label for="state" class="block text-sm font-medium text-gray-700 mb-1">UF</label>
        <select id="state" name="state" class="w-full h-12 border rounded-lg px-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white border-slate-300">
          <option value="">Selecione</option>
          <option value="AC">AC - Acre</option>
          <option value="AL">AL - Alagoas</option>
          <option value="AP">AP - Amap√°</option>
          <option value="AM">AM - Amazonas</option>
          <option value="BA">BA - Bahia</option>
          <option value="CE">CE - Cear√°</option>
          <option value="DF">DF - Distrito Federal</option>
          <option value="ES">ES - Esp√≠rito Santo</option>
          <option value="GO">GO - Goi√°s</option>
          <option value="MA">MA - Maranh√£o</option>
          <option value="MT">MT - Mato Grosso</option>
          <option value="MS">MS - Mato Grosso do Sul</option>
          <option value="MG">MG - Minas Gerais</option>
          <option value="PA">PA - Par√°</option>
          <option value="PB">PB - Para√≠ba</option>
          <option value="PR">PR - Paran√°</option>
          <option value="PE">PE - Pernambuco</option>
          <option value="PI">PI - Piau√≠</option>
          <option value="RJ">RJ - Rio de Janeiro</option>
          <option value="RN">RN - Rio Grande do Norte</option>
          <option value="RS">RS - Rio Grande do Sul</option>
          <option value="RO">RO - Rond√¥nia</option>
          <option value="RR">RR - Roraima</option>
          <option value="SC">SC - Santa Catarina</option>
          <option value="SP">SP - S√£o Paulo</option>
          <option value="SE">SE - Sergipe</option>
          <option value="TO">TO - Tocantins</option>
        </select>
      </div>
      <div>
        <label for="city" class="block text-sm font-medium text-gray-700 mb-1">Cidade</label>
        <input id="city" name="city" placeholder="Cidade" class="w-full h-12 border rounded-lg px-3">
      </div>
    </div>
    <input name="note" placeholder="Observa√ß√£o" class="border rounded-lg px-3 h-12 w-full">
    
    <!-- Forma de pagamento -->
    <div class="mt-4">
      <div class="text-sm font-medium text-gray-700 mb-2">Forma de pagamento</div>
      <div class="flex gap-4">
        <label class="inline-flex items-center gap-2 cursor-pointer">
          <input type="radio" name="payment_method" value="credito" required class="w-4 h-4 text-blue-600">
          <span class="text-sm">üí≥ Cr√©dito</span>
        </label>
        <label class="inline-flex items-center gap-2 cursor-pointer">
          <input type="radio" name="payment_method" value="debito" class="w-4 h-4 text-blue-600">
          <span class="text-sm">üí≥ D√©bito</span>
        </label>
        <label class="inline-flex items-center gap-2 cursor-pointer">
          <input type="radio" name="payment_method" value="pix" class="w-4 h-4 text-blue-600">
          <span class="text-sm">üì± PIX</span>
        </label>
        <label class="inline-flex items-center gap-2 cursor-pointer">
          <input type="radio" name="payment_method" value="dinheiro" class="w-4 h-4 text-blue-600">
          <span class="text-sm">üíµ Dinheiro</span>
        </label>
      </div>
    </div>
  </div>

  <div class="bg-white rounded-xl p-6 shadow">
    <div class="text-slate-500 text-sm">Resumo</div>
    <div class="text-2xl font-bold mt-2" id="previewTotal">R$ 0,00</div>
    <div class="text-sm text-slate-600 mt-2" id="previewDetails">Selecione as quantidades</div>
    <button type="submit" class="w-full h-14 mt-4 rounded-xl bg-emerald-700 text-white text-lg">
      üõí Registrar Venda
    </button>
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
    <a href="/dashboard" class="block text-center mt-3 text-slate-600 hover:text-slate-800">
      ‚Üê Voltar ao Dashboard
    </a>
  </div>
</form>

<script>
  const prices = { 'inteira': 10, 'meia': 5, 'gratuita': 0 };
  
  function updatePreview() {
    const qtdInteira = parseInt(document.getElementById('qtd_inteira').value) || 0;
    const qtdMeia = parseInt(document.getElementById('qtd_meia').value) || 0;
    const qtdGratuita = parseInt(document.getElementById('qtd_gratuita').value) || 0;
    
    const totalInteira = qtdInteira * prices.inteira;
    const totalMeia = qtdMeia * prices.meia;
    const totalGratuita = qtdGratuita * prices.gratuita;
    const total = totalInteira + totalMeia + totalGratuita;
    
    const totalQtd = qtdInteira + qtdMeia + qtdGratuita;
    
    document.getElementById('previewTotal').textContent = `R$ ${total.toFixed(2)}`;
    
    if (totalQtd > 0) {
      let details = [];
      if (qtdInteira > 0) details.push(`${qtdInteira} inteira(s)`);
      if (qtdMeia > 0) details.push(`${qtdMeia} meia(s)`);
      if (qtdGratuita > 0) details.push(`${qtdGratuita} gratuita(s)`);
      document.getElementById('previewDetails').textContent = details.join(' + ');
    } else {
      document.getElementById('previewDetails').textContent = 'Selecione as quantidades';
    }
  }
  
  // Adiciona listeners para atualizar preview
  document.getElementById('qtd_inteira').addEventListener('input', updatePreview);
  document.getElementById('qtd_meia').addEventListener('input', updatePreview);
  document.getElementById('qtd_gratuita').addEventListener('input', updatePreview);
  
  // Inicializa preview
  updatePreview();
</script>
{% endblock %}